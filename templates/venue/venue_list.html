{% extends '../base.html' %}

{% block title %}Discover Amazing Venues - EventVenue{% endblock %}


{% block content %}
<div class="hero">
    <h1>Discover Amazing Venues</h1>
    <p>Find the perfect space for your next unforgettable event</p>
</div>

{% comment %} <!-- Search Section -->
<div class="search-section">
    <form class="search-form" method="GET">
        <div class="form-group">
            <label for="search">Search Venues</label>
            <input type="text" id="search" name="search" class="form-input" placeholder="Enter venue name or location..." value="{{ request.GET.search }}">
        </div>
        <div class="form-group">
            <label for="capacity">Min Capacity</label>
            <input type="number" id="capacity" name="capacity" class="form-input" placeholder="50" value="{{ request.GET.capacity }}">
        </div>
        <div class="form-group">
            <label for="max_price">Max Price/Hour</label>
            <input type="number" id="max_price" name="max_price" class="form-input" placeholder="500" value="{{ request.GET.max_price }}">
        </div>
        <button type="submit" class="search-btn">
            <i class="fas fa-search"></i>
            Search
        </button>
    </form>
</div> {% endcomment %}

<!-- Stats Section -->
<div class="stats-section">
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-building"></i>
        </div>
        <span class="stat-number">{{ venues.count|default:"0" }}</span>
        <span class="stat-label">Available Venues</span>
    </div>
    {% comment %} <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-users"></i>
        </div>
        <span class="stat-number">10K+</span>
        <span class="stat-label">Happy Customers</span>
    </div> {% endcomment %}
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-star"></i>
        </div>
        <span class="stat-number">4.9</span>
        <span class="stat-label">Average Rating</span>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-calendar-check"></i>
        </div>
        <span class="stat-number">500+</span>
        <span class="stat-label">Events This Month</span>
    </div>
</div>

<!-- Active Filters -->
{% if request.GET.search or request.GET.capacity or request.GET.max_price %}
<div class="filter-tags">
    <span style="color: rgba(255,255,255,0.8); font-weight: 500;">Active Filters:</span>
    {% if request.GET.search %}
    <div class="filter-tag">
        <i class="fas fa-search"></i>
        "{{ request.GET.search }}"
        <span class="remove" onclick="removeFilter('search')">×</span>
    </div>
    {% endif %}
    {% if request.GET.capacity %}
    <div class="filter-tag">
        <i class="fas fa-users"></i>
        Min {{ request.GET.capacity }} people
        <span class="remove" onclick="removeFilter('capacity')">×</span>
    </div>
    {% endif %}
    {% if request.GET.max_price %}
    <div class="filter-tag">
        <i class="fas fa-dollar-sign"></i>
        Max ${{ request.GET.max_price }}/hr
        <span class="remove" onclick="removeFilter('max_price')">×</span>
    </div>
    {% endif %}
    <div class="filter-tag" onclick="clearAllFilters()" style="background: rgba(239, 68, 68, 0.2); border-color: rgba(239, 68, 68, 0.3);">
        <i class="fas fa-times"></i>
        Clear All
    </div>
</div>
{% endif %}

<div class="content-card">
    {% if venues %}
        <div class="venues-grid">
            {% for venue in venues %}
            <div class="venue-card">
                <div class="venue-image">
                    {% if venue.image %}
                        <img src="{{ venue.image.url }}" alt="{{ venue.name }}" loading="lazy">
                    {% else %}
                        <div class="venue-image-placeholder">
                            <i class="fas fa-building"></i>
                            {{ venue.name }}
                        </div>
                    {% endif %}
                    {% if venue.is_available %}
                        <div class="venue-badge">
                            <i class="fas fa-check-circle"></i>
                            Available
                        </div>
                    {% endif %}
                </div>
                
                <div class="venue-info">
                    <div class="venue-header">
                        <div>
                            <h3 class="venue-name">{{ venue.name }}</h3>
                            <div class="venue-location">
                                <i class="fas fa-map-marker-alt"></i>
                                {{ venue.location }}
                            </div>
                        </div>
                    </div>

                    <div class="venue-features">
                        {% if venue.get_amenities_list %}
                            {% for amenity in venue.get_amenities_list|slice:":3" %}
                                <span class="feature-tag">
                                    <i class="fas fa-check"></i>
                                    {{ amenity }}
                                </span>
                            {% endfor %}
                            {% if venue.get_amenities_list|length > 3 %}
                                <span class="feature-tag">
                                    <i class="fas fa-plus"></i>
                                    +{{ venue.get_amenities_list|length|add:"-3" }} more
                                </span>
                            {% endif %}
                        {% endif %}
                    </div>

                    <div class="venue-details">
                        <div class="detail-item">
                            <span class="detail-value">
                                <i class="fas fa-users"></i>
                                {{ venue.capacity }}
                            </span>
                            <span class="detail-label">Max Capacity</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-value">
                                <i class="fas fa-dollar-sign"></i>
                                {{ venue.price_per_hour }}
                            </span>
                            <span class="detail-label">Per Hour</span>
                        </div>
                    </div>

                    <div class="venue-actions">
                        <a href="{% url 'venue:detail' venue.pk %}" class="view-btn">
                            <i class="fas fa-eye"></i>
                            View Details
                        </a>
                        <button class="favorite-btn" onclick="toggleFavorite({{ venue.pk }})">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        {% if is_paginated %}
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.capacity %}capacity={{ request.GET.capacity }}&{% endif %}{% if request.GET.max_price %}max_price={{ request.GET.max_price }}&{% endif %}page=1">
                    <i class="fas fa-angle-double-left"></i>
                </a>
                <a href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.capacity %}capacity={{ request.GET.capacity }}&{% endif %}{% if request.GET.max_price %}max_price={{ request.GET.max_price }}&{% endif %}page={{ page_obj.previous_page_number }}">
                    <i class="fas fa-angle-left"></i>
                </a>
            {% else %}
                <span class="disabled">
                    <i class="fas fa-angle-double-left"></i>
                </span>
                <span class="disabled">
                    <i class="fas fa-angle-left"></i>
                </span>
            {% endif %}
            
            <span class="current">{{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            
            {% if page_obj.has_next %}
                <a href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.capacity %}capacity={{ request.GET.capacity }}&{% endif %}{% if request.GET.max_price %}max_price={{ request.GET.max_price }}&{% endif %}page={{ page_obj.next_page_number }}">
                    <i class="fas fa-angle-right"></i>
                </a>
                <a href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.capacity %}capacity={{ request.GET.capacity }}&{% endif %}{% if request.GET.max_price %}max_price={{ request.GET.max_price }}&{% endif %}page={{ page_obj.paginator.num_pages }}">
                    <i class="fas fa-angle-double-right"></i>
                </a>
            {% else %}
                <span class="disabled">
                    <i class="fas fa-angle-right"></i>
                </span>
                <span class="disabled">
                    <i class="fas fa-angle-double-right"></i>
                </span>
            {% endif %}
        </div>
        {% endif %}
    {% else %}
        <div class="no-venues">
            <div class="no-venues-icon">
                <i class="fas fa-search"></i>
            </div>
            <h2>No venues found</h2>
            <p>We couldn't find any venues matching your criteria. Try adjusting your search filters or check back later for new listings.</p>
            <a href="/" class="create-venue-btn">
                <i class="fas fa-plus"></i>
                List Your Venue
            </a>
        </div>
    {% endif %}
</div>

<script>
    // Filter management
    function removeFilter(filterName) {
        const url = new URL(window.location);
        url.searchParams.delete(filterName);
        window.location.href = url.toString();
    }

    function clearAllFilters() {
        const url = new URL(window.location);
        url.searchParams.delete('search');
        url.searchParams.delete('capacity');
        url.searchParams.delete('max_price');
        window.location.href = url.toString();
    }

    // Favorite functionality
    function toggleFavorite(venueId) {
        const btn = event.target.closest('.favorite-btn');
        const icon = btn.querySelector('i');
        
        if (icon.classList.contains('far')) {
            icon.classList.remove('far');
            icon.classList.add('fas');
            btn.style.background = 'rgba(239, 68, 68, 0.2)';
            btn.style.color = '#ef4444';
        } else {
            icon.classList.remove('fas');
            icon.classList.add('far');
            btn.style.background = 'rgba(239, 68, 68, 0.1)';
            btn.style.color = '#ef4444';
        }
        
        // Add API call here to save favorite status
        console.log('Toggled favorite for venue:', venueId);
    }

    // Search form enhancements
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('search');
        const capacityInput = document.getElementById('capacity');
        const priceInput = document.getElementById('max_price');

        // Add real-time search suggestions (placeholder for future implementation)
        searchInput.addEventListener('input', function() {
            // Implement search suggestions here
        });

        // Add input validation
        capacityInput.addEventListener('input', function() {
            if (this.value < 0) this.value = 0;
        });

        priceInput.addEventListener('input', function() {
            if (this.value < 0) this.value = 0;
        });

        // Animate cards on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.animationPlayState = 'running';
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.venue-card').forEach(card => {
            observer.observe(card);
        });
    });
</script>
{% endblock %}